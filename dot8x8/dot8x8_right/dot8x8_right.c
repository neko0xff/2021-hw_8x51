/*
* File: dot8x8.c
* 功能: 令 8X8 單色點矩陣週而復始的依序顯示 0～9
*/

#include "io51.h"
/*8*8點距陣(0~9)顯示碼*/
code char dot8x8[80]={
    0xFF,0x81,0x5E,0x6E,0x76,0x7A,0x81,0xFF, //0
    0xFF,0x7F,0x7F,0x7D,0x00,0x7F,0x7F,0xFF, //1
    0xFF,0x1D,0x6E,0x6E,0x6E,0x6E,0x71,0xFF, //2
    0xFF,0xBD,0x7E,0x76,0x76,0x76,0x89,0xFF, //3
    0xFF,0xE3,0xED,0xEE,0xEF,0x00,0xEF,0xFF, //4
    0xFF,0xB0,0x76,0x76,0x76,0x76,0x8E,0xFF, //5
    0xFF,0x81,0x76,0x76,0x76,0x76,0x8D,0xFF, //6
    0xFF,0xFC,0xFE,0xFE,0x06,0xFA,0xFC,0xFF, //7
    0xFF,0x89,0x76,0x76,0x76,0x76,0x89,0xFF, //8
    0xFF,0xB1,0x6E,0x6E,0x6E,0x6E,0x81,0xFF  //9
};
char buf[8]; //緩衝器
void delay(int x);
void shift_right();

/*主程式*/
void main(){
   int i,j,k;

   /*清除存放左移資料的buf[8]*/
   for(i=0;i<8;i++) buf[i]=0xFF; 

   while(1){
       for(i=0;i<8*10;i++){
           /*把左移資料分別存在buf[]中*/
           for(j=0;j<7;j++){
               buf[j]= buf[j+1];
               buf[j]= dot8x8[i];
           } 
           /*重復掃描各字型50回(增加亮度)*/
           for(k=0;k<50;k++){
               shift_right(); //字型右移
           }
       }
   }
}

/*call 右移的副程式*/
void shift_right(){
    int i;
    int enable_signal=0x01;//致能=0x01

    /*各字型由8筆資料組成=掃8回*/
    for(i=0;i<8;i++){
		/*把左移資料分別存在buf[]中*/
        P1=buf[i];
        P2=enable_signal;
        delay(50); //delay 50ms=0.05sec
        enable_signal>>=1; //左移1個位元
    }
}

/*delay time*/
void delay(int x){
    int m;
    for(m=0;m<x;m++);
}